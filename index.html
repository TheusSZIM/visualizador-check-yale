<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Yale MR16 - Sistema de Monitoramento</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg { background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); }
        .status-card { transition: transform 0.2s ease-in-out; }
        .status-card:hover { transform: translateY(-2px); }
        .nav-item { transition: all 0.2s ease-in-out; }
        .nav-item:hover { background-color: #f3f4f6; }
        .nav-item.active { background-color: #2563eb; color: white; }
        .alert-blink { animation: blink 2s infinite; }
        @keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0.5; } }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <div class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 py-4">
            </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 py-6">
        <div class="flex flex-col md:flex-row space-y-6 md:space-y-0 md:space-x-6">
            <div class="w-full md:w-64 bg-white rounded-lg shadow-sm p-4">
                <nav class="space-y-2">
                    <button class="nav-item active w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left" onclick="showTab('overview', event)"><i data-lucide="home" class="w-5 h-5"></i><span class="font-medium">Visão Geral</span></button>
                    </nav>
            </div>
            <div class="flex-1">
                <div id="tab-overview" class="tab-content space-y-6">
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Resumo dos Últimos 7 Dias</h3>
                        <div class="relative h-96">
                            <canvas id="monitoring-chart"></canvas>
                        </div>
                    </div>
                </div>
                </div>
        </div>
    </div>

    <script>
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbz15btVsdKrUesS57M62devbxFYvrqfOZ0Tvul4hF3NvSDKq3msyQYi15DVTFtX3B55vg/exec';
        let monitoringChart = null;

        async function fetchDataAndUpdateDashboard() {
            try {
                const response = await fetch(WEB_APP_URL);
                const data = await response.json();
                
                // ... (código para atualizar os cards e outras seções)

                // Chama a função para atualizar o gráfico com os novos dados diários
                updateChart(data.dailySummary);

            } catch (error) {
                console.error('Falha ao carregar dados:', error);
            } finally {
                lucide.createIcons();
            }
        }

        function updateChart(dailySummary) {
            if (!dailySummary) return;

            const labels = dailySummary.map(item => item.dateLabel);
            const conformityData = dailySummary.map(item => item.averageConformity);
            const problemsData = dailySummary.map(item => item.totalProblems);
            
            const ctx = document.getElementById('monitoring-chart').getContext('2d');
            if (monitoringChart) monitoringChart.destroy();

            monitoringChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Conformidade Média (%)',
                        data: conformityData,
                        borderColor: '#2563eb', // Azul
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        yAxisID: 'y',
                        tension: 0.3
                    }, {
                        label: 'Total de Problemas',
                        data: problemsData,
                        borderColor: '#16a34a', // Verde
                        backgroundColor: 'rgba(22, 163, 74, 0.1)',
                        yAxisID: 'y1',
                        tension: 0.3,
                        stepped: true // Opcional: para um visual de "degraus"
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: { type: 'linear', position: 'left', title: { display: true, text: 'Conformidade (%)' }, min: 0, max: 100 },
                        y1: { type: 'linear', position: 'right', title: { display: true, text: 'Nº de Problemas' }, grid: { drawOnChartArea: false }, min: 0, ticks: { stepSize: 1 } }
                    }
                }
            });
        }

        // ... (resto das funções: showTab, updateTime, etc.)

        document.addEventListener('DOMContentLoaded', function() {
            showTab('overview');
            lucide.createIcons();
            fetchDataAndUpdateDashboard();
            setInterval(fetchDataAndUpdateDashboard, 10000); // Atualiza a cada 5 minutos
            // ...
        });
    </script>
</body>
</html>
